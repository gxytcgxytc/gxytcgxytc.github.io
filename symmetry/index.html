<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>司马对称</title>
  <style>
    .file {
      padding: 24px;
      background-color: aliceblue;
    }

    .dragover {
      background-color: aqua;
    }
  </style>


</head>

<body>
  拖...拖拽到右侧 <input type="file" id="file" class="file">
  <p></p>
  <canvas id="canvas1" width="400px" height="300px"></canvas><button onclick="download('canvas1')">下载</button>
  <canvas id="canvas2" width="400px" height="300px"></canvas><button onclick="download('canvas2')">下载</button>
  <canvas id="canvas3" width="400px" height="300px"></canvas><button onclick="download('canvas3')">下载</button>
  <canvas id="canvas4" width="400px" height="300px"></canvas><button onclick="download('canvas4')">下载</button>
</body>

<script>
  const download = (selector) => {
    const canvas = document.querySelector(selector);
    const el = document.createElement(a);
    el.href = canvas.toDataURL();
    el.download = "cymmetry";
    const event = new MouseEvent('click');
    el.dispatchEvent(event);
  }
  const file = document.getElementById('file');
  file.ondragenter = () => {
    file.classList.add('dragover');
  }
  file.onchange = () => {
    file.classList.remove('dragover');
    create();
  }
  file.ondragleave = () => {
    file.classList.remove('dragover');
  }

  // 创建图像任务
  const create = () => {
    const img = new Image();
    img.onload = () => {
      symmetryLeft(img);
      symmetryRight(img);
      symmetryBottom(img);
      symmetryTop(img);
    };
    img.src = URL.createObjectURL(file.files[0]);
  }


  const drawRawImage = (img, canvasId) => {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);
    return ctx
  }

  const symmetryLeft = (img) => {
    const ctx = drawRawImage(img, 'canvas1');
    const imgData = ctx.getImageData(0, 0, img.width / 2, img.height);
    ctx.save()
    ctx.translate(img.width / 2, 0);
    ctx.scale(-1, 1)
    ctx.drawImage(img, - img.width / 2, 0);
    ctx.restore()
    ctx.putImageData(imgData, 0, 0);
  }
  const symmetryRight = (img) => {
    const ctx = drawRawImage(img, 'canvas2');
    const imgData = ctx.getImageData(img.width / 2, 0, img.width / 2, img.height);
    ctx.save()
    ctx.translate(img.width / 2, 0);
    ctx.scale(-1, 1)
    ctx.drawImage(img, - img.width / 2, 0);
    ctx.restore()
    ctx.putImageData(imgData, img.width / 2, 0);
  }
  const symmetryBottom = (img) => {
    const ctx = drawRawImage(img, 'canvas3');
    const imgData = ctx.getImageData(0, img.height / 2, img.width, img.height / 2);
    ctx.save()
    ctx.translate(0, img.height / 2);
    ctx.scale(1, -1)
    ctx.drawImage(img, 0, - img.height / 2);
    ctx.restore()
    ctx.putImageData(imgData, 0, img.height / 2);
  }

  const symmetryTop = (img) => {
    const ctx = drawRawImage(img, 'canvas4');
    const imgData = ctx.getImageData(0, 0, img.width, img.height / 2);
    ctx.save()
    ctx.translate(0, img.height / 2);
    ctx.scale(1, -1)
    ctx.drawImage(img, 0, - img.height / 2);
    ctx.restore()
    ctx.putImageData(imgData, 0, 0);

  }
// 后续考虑把imgData 换成 ImageData可以方便组合变换

</script>

</html>
